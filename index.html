<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dhanu — A Little Universe</title>
<meta name="description" content="A cinematic, optimized single-file love page for Dhanu. Place us.png and song.mp3 in same folder." />
<style>
  :root{
    --bg1:#04030b;
    --bg2:#241034;
    --accent:#ff6fa3;
    --gold:#ffd08a;
    --muted:#cfc7e4;
    --glass:rgba(255,255,255,0.03);
    --maxw:1100px;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden}
  .stage{width:min(98vw,var(--maxw));height:min(92vh,880px);position:relative;display:grid;place-items:center}
  .card{width:100%;height:100%;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.008));box-shadow:0 30px 90px rgba(4,3,10,0.75);position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;gap:28px;padding:28px;align-items:center}
  /* left */
  .left{width:34%;min-width:240px;display:flex;flex-direction:column;gap:10px}
  .brand{font-family:'Playfair Display',serif;color:var(--gold);font-size:20px}
  .title{font-size:30px;margin:6px 0 0 0;line-height:1.02;color:#fff}
  .subtitle{color:var(--muted);font-size:14px;margin-top:6px}
  .hint{color:#bfb7da;font-size:13px;margin-top:12px}
  /* center */
  .center{flex:1;display:flex;align-items:center;justify-content:center;position:relative;min-width:360px}
  .frame{
    width:420px;height:420px;border-radius:20px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.04);box-shadow:0 40px 80px rgba(6,4,20,0.6);display:flex;align-items:center;justify-content:center;transition:transform 260ms ease, box-shadow 260ms ease;cursor:pointer;will-change:transform;
    transform-style:preserve-3d;
  }
  .frame:focus{outline:3px solid rgba(255,111,163,0.12);outline-offset:8px;border-radius:14px}
  .frame.playing{transform:translateY(-6px) scale(1.01)}
  .photo{width:100%;height:100%;border-radius:12px;overflow:hidden;background:#000;transform:translateZ(40px);box-shadow:inset 0 -8px 40px rgba(0,0,0,0.35)}
  .photo img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 900ms cubic-bezier(.2,.9,.2,1)}
  /* right */
  .right{width:34%;min-width:240px;display:flex;flex-direction:column;gap:12px}
  .poemBox{background:var(--glass);border-radius:12px;padding:16px;min-height:240px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;justify-content:center;gap:10px}
  .poemLines{white-space:pre-wrap;color:#fff4f7;font-style:italic;line-height:1.65;font-size:15px;max-height:420px;overflow:auto;padding-right:6px}
  .controls{display:flex;gap:10px;margin-top:8px}
  .btn{background:linear-gradient(90deg,var(--accent),#ff95c6);border:none;color:#08101a;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(255,106,150,0.12)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:600}
  .finalBanner{position:absolute;bottom:22px;left:50%;transform:translateX(-50%) translateY(10px);padding:10px 18px;border-radius:999px;background:linear-gradient(90deg,rgba(255,111,163,0.12),rgba(255,210,130,0.06));color:#fff;font-weight:700;opacity:0;transition:all 520ms cubic-bezier(.2,.9,.2,1);pointer-events:none;box-shadow:0 10px 28px rgba(8,4,24,0.5)}
  .finalBanner.show{opacity:1;transform:translateX(-50%) translateY(0)}
  /* canvases */
  canvas{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:0}
  .card > *{position:relative;z-index:2}
  @media (max-width:880px){.card{flex-direction:column;padding:18px;gap:18px;align-items:center;overflow:auto}.left,.right{width:100%;min-width:unset;text-align:center}.center{order:0}.frame{width:84vw;height:84vw;max-width:460px;max-height:460px}}
</style>
</head>
<body>
  <div class="stage" role="main" aria-labelledby="mainTitle">
    <div class="card" role="region" aria-label="Locket experience for Dhanu">
      <canvas id="stars"></canvas>
      <canvas id="confetti"></canvas>

      <div class="left">
        <div class="brand">Our Locket</div>
        <h1 class="title" id="mainTitle">For Dhanu — A Little Universe</h1>
        <div class="subtitle">Click the frame to reveal a letter. Press Play to set the mood.</div>
        <div class="hint">Tip: headphones make the glow feel alive. Keyboard: Tab → Frame → Enter to open.</div>
      </div>

      <div class="center">
        <div class="frame" id="frame" role="button" tabindex="0" aria-pressed="false" aria-label="Open photo & reveal poem">
          <div class="photo" id="photo">
            <img id="pic" src="us.png" alt="A photo of us together (Dhanu and me)" onerror="this.onerror=null;this.src='https://placehold.co/600x600/241034/f6eef8?text=Our+Photo';" />
          </div>
        </div>
      </div>

      <div class="right">
        <div class="poemBox" aria-live="polite">
          <div id="poem" class="poemLines" tabindex="0" aria-atomic="false"></div>
          <div class="controls" role="toolbar" aria-label="Playback controls">
            <button class="btn" id="play">Play</button>
            <button class="btn ghost" id="replay">Replay Poem</button>
            <button class="btn ghost" id="mute">Mute</button>
          </div>
        </div>
      </div>

      <div class="finalBanner" id="final">Forever yours, <span style="color:var(--gold)">Dhanu</span> 💖</div>
    </div>
  </div>

<script>
/* =========================
   Dhanu — single-file cinematic site
   Place us.png and song.mp3 beside this file
   Designed for smoothness: small FFT, limited particles, rAF loops
   ========================= */

/* Elements */
const starsCanvas = document.getElementById('stars');
const confCanvas = document.getElementById('confetti');
const frame = document.getElementById('frame');
const pic = document.getElementById('pic');
const poemEl = document.getElementById('poem');
const playBtn = document.getElementById('play');
const replayBtn = document.getElementById('replay');
const muteBtn = document.getElementById('mute');
const finalBanner = document.getElementById('final');

/* Audio */
const audio = new Audio('song.mp3');
audio.crossOrigin = "anonymous";
audio.preload = "auto";
let audioCtx=null, analyser=null, dataArr=null, source=null;
let audioReady=false, isPlaying=false;

/* Poem: longer, cinematic */
const poem = [
  "Dhanu —",
  "I have gathered small steady lights and folded them into your name.",
  "Every ordinary morning with you is a discovery: warmth where there was none, color where there was gray.",
  "When you laugh, the room rearranges itself to fit our happiness.",
  "You are the map I return to when the world is loud, the quiet I carry like a small, sure breath.",
  "This frame holds a photograph, yes — and it holds my promise: small gestures, honest days, an endless yes.",
  "Open this when you want to remember you are loved, more than any language can say.",
  "Always yours, with every impossible little heartbeat. 💖"
];

/* Typewriter state */
let pIdx=0, cIdx=0, typing=false, typeTimer=null;

/* Canvas sizing */
function fitCanvas(c){ const dpr=window.devicePixelRatio||1; c.width = Math.floor(window.innerWidth*dpr); c.height = Math.floor(window.innerHeight*dpr); c.style.width = window.innerWidth+'px'; c.style.height = window.innerHeight+'px'; }
fitCanvas(starsCanvas); fitCanvas(confCanvas);
window.addEventListener('resize', ()=>{ fitCanvas(starsCanvas); fitCanvas(confCanvas); initStars(); });

/* --------- Stars (lightweight) ---------- */
const sCtx = starsCanvas.getContext('2d');
let stars=[]; const STAR_COUNT = Math.max(12, Math.floor(Math.min(window.innerWidth, window.innerHeight)/80));
function initStars(){
  stars = [];
  const W = starsCanvas.width, H = starsCanvas.height;
  for(let i=0;i<STAR_COUNT;i++){
    stars.push({
      x: Math.random()*W,
      y: Math.random()*H,
      r: (Math.random()*1.4 + 0.4) * (window.devicePixelRatio||1),
      hue: 240 + Math.random()*140,
      phase: Math.random()*Math.PI*2,
      vx: (Math.random()-0.5)*0.05,
      vy: (Math.random()-0.5)*0.05
    });
  }
}
initStars();
function drawStars(){
  const W = starsCanvas.width, H = starsCanvas.height;
  sCtx.clearRect(0,0,W,H);
  for(let s of stars){
    s.x += s.vx; s.y += s.vy; s.phase += 0.018;
    if(s.x < -60) s.x = W + 60; if(s.x > W + 60) s.x = -60;
    if(s.y < -60) s.y = H + 60; if(s.y > H + 60) s.y = -60;
    const alpha = 0.12 + Math.sin(s.phase)*0.12;
    const grad = sCtx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*20);
    grad.addColorStop(0, `hsla(${s.hue},85%,70%,${alpha})`);
    grad.addColorStop(1,'rgba(0,0,0,0)');
    sCtx.fillStyle = grad;
    sCtx.beginPath(); sCtx.arc(s.x, s.y, s.r*14, 0, Math.PI*2); sCtx.fill();
  }
  requestAnimationFrame(drawStars);
}
requestAnimationFrame(drawStars);

/* --------- Audio init (on gesture) ---------- */
function initAudio(){
  if(audioCtx) return;
  try{
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128; // small → cheap
    dataArr = new Uint8Array(analyser.frequencyBinCount);
    source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser); analyser.connect(audioCtx.destination);
    audioReady=true;
  }catch(e){
    console.warn('WebAudio init failed',e);
    audioReady=false;
  }
}
async function playAudio(){
  initAudio();
  try{
    await audio.play();
    isPlaying=true; playBtn.textContent='Pause';
  }catch(e){
    console.warn('play blocked',e); isPlaying=false; playBtn.textContent='Play';
  }
}
function pauseAudio(){ audio.pause(); isPlaying=false; playBtn.textContent='Play'; }

/* Mute */
muteBtn.addEventListener('click', ()=>{ audio.muted = !audio.muted; muteBtn.textContent = audio.muted ? 'Unmute' : 'Mute'; });

/* Play control */
playBtn.addEventListener('click', async ()=>{ if(!isPlaying) await playAudio(); else pauseAudio(); });

/* When window hidden, pause to save CPU */
document.addEventListener('visibilitychange', ()=>{ if(document.hidden && isPlaying) pauseAudio(); });

/* --------- Typewriter (constellation reveal) ---------- */
function startPoemRestart(){
  poemEl.textContent=''; pIdx=0;cIdx=0; typing=false;
  startPoem();
}
function startPoem(){
  if(typing) return;
  typing=true; typeNextLine();
}
function typeNextLine(){
  if(pIdx >= poem.length){ typing=false; poemDone(); return; }
  const line = poem[pIdx] + (pIdx < poem.length-1 ? '\n\n' : '');
  cIdx=0;
  typeTimer = setInterval(()=>{
    poemEl.textContent += line.charAt(cIdx);
    cIdx++;
    poemEl.scrollTop = poemEl.scrollHeight;
    if(cIdx >= line.length){
      clearInterval(typeTimer);
      pIdx++;
      setTimeout(typeNextLine, 420 + Math.random()*120);
    }
  }, 18 + Math.floor(Math.random()*28));
}

/* Replay */
replay.addEventListener('click', ()=>{ if(!audioCtx) initAudio(); if(!isPlaying) playAudio(); startPoemRestart(); pulseFrame(); });

/* --------- Frame interaction: tilt + reveal + heartbeat pulse ---------- */
let revealed=false;
function pulseFrame(){
  frame.animate([{ transform:'translateY(0) scale(1)' },{ transform:'translateY(-6px) scale(1.02)' },{ transform:'translateY(0) scale(1)'}], { duration:900, easing:'ease-in-out' });
  pic.animate([{ transform:'scale(1)' },{ transform:'scale(1.03)' },{ transform:'scale(1)'}], { duration:1200, easing:'ease' });
}

function reveal(){
  if(!revealed){
    revealed=true;
    frame.classList.add('playing');
    if(!audioReady) initAudio();
    if(!isPlaying) playAudio();
    startPoemRestart();
    pulseFrame();
  } else {
    pulseFrame();
  }
}
frame.addEventListener('click', ()=>{ reveal(); });
frame.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); reveal(); } });

/* 3D tilt (follow mouse/touch) — lightweight math */
let rect = frame.getBoundingClientRect();
function updateRect(){ rect = frame.getBoundingClientRect(); }
window.addEventListener('resize', updateRect);
function handleMove(clientX, clientY){
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  const dx = (clientX - cx) / (rect.width/2);
  const dy = (clientY - cy) / (rect.height/2);
  const rx = clamp(-dy * 8, -12, 12);
  const ry = clamp(dx * 10, -14, 14);
  frame.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`;
  pic.style.transform = `translateZ(40px) rotateX(${rx*0.2}deg) rotateY(${ry*0.25}deg) scale(${1 + Math.abs(dx+dy)*0.01})`;
}
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
window.addEventListener('pointermove', (e)=>{ if(!rect.width) updateRect(); handleMove(e.clientX, e.clientY); });
window.addEventListener('pointerleave', ()=>{ frame.style.transform=''; pic.style.transform=''; });

/* --------- Glow reactive to audio (smoothed, cheap) ---------- */
let glow = 0;
function updateGlow(){
  if(!audioReady || !isPlaying){ glow = 0.06 + 0.02*Math.sin(Date.now()*0.002); }
  else {
    analyser.getByteFrequencyData(dataArr);
    let sum=0, cnt=0;
    for(let i=1;i<10 && i<dataArr.length;i++){ sum+=dataArr[i]; cnt++; }
    const avg = cnt ? (sum/cnt)/255 : 0;
    const target = Math.min(1.2, avg*1.9 + 0.04);
    glow = glow*0.82 + target*0.18;
  }
  const scale = 1 + glow*0.03;
  const shadow = Math.min(56, 12 + glow*44);
  frame.style.boxShadow = `0 ${shadow}px ${shadow*1.6}px rgba(255,90,140,${0.05 + glow*0.06})`;
  if(!revealed) frame.style.transform = `translateZ(0) scale(${scale})`;
  requestAnimationFrame(updateGlow);
}
requestAnimationFrame(updateGlow);

/* --------- Confetti (capped & short) ---------- */
const confCtx = confCanvas.getContext('2d');
function burstConfetti(){
  const W = confCanvas.width, H = confCanvas.height;
  const list = []; const colors=['#ff6fa3','#ffd08a','#7ad8ff','#cfa3ff','#fff2d6'];
  const count = Math.min(100, Math.max(48, Math.floor((W*H)/180000)));
  for(let i=0;i<count;i++){
    list.push({
      x: W/2 + (Math.random()-0.5)*260,
      y: H/2 + (Math.random()-0.5)*120,
      vx: (Math.random()-0.5)*10,
      vy: -6 - Math.random()*7,
      size: 6 + Math.random()*10,
      rot: Math.random()*360,
      color: colors[Math.floor(Math.random()*colors.length)],
      gravity: 0.34 + Math.random()*0.34
    });
  }
  let frames=0;
  function step(){
    frames++;
    confCtx.clearRect(0,0,confCanvas.width, confCanvas.height);
    for(let p of list){
      p.vy += p.gravity;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vx*0.08;
      confCtx.save();
      confCtx.translate(p.x,p.y);
      confCtx.rotate(p.rot * Math.PI/180);
      confCtx.fillStyle = p.color;
      confCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      confCtx.restore();
    }
    if(frames < 220) requestAnimationFrame(step);
    else confCtx.clearRect(0,0,confCanvas.width, confCanvas.height);
  }
  requestAnimationFrame(step);
}

/* --------- Gentle cascade that spells Dhanu with stars (finale) ---------- */
function finale(){
  finalBanner.classList.add('show');
  burstConfetti();
  // star dots that move into place to form letters (cheap)
  const W = starsCanvas.width, H = starsCanvas.height;
  const ctx = starsCanvas.getContext('2d');
  const letters = "DHANU";
  // compute rough points for letters using pre-defined simplified patterns (very small set) to avoid heavy fonts
  // We'll map each letter to a few anchor positions relative to center
  const centerX = W/2, centerY = H/2;
  const points = [];
  const gap = 34 * (window.devicePixelRatio || 1);
  for(let i=0;i<letters.length;i++){
    const ch = letters[i];
    const baseX = centerX + (i - (letters.length-1)/2) * gap * 1.8;
    const baseY = centerY - 40 * (window.devicePixelRatio || 1);
    // generate 28 points per letter in a small cluster, slightly different per letter
    for(let p=0;p<28;p++){
      points.push({
        tx: baseX + (Math.cos((p/28)*Math.PI*2) * (12 + (i%3)*4) * (window.devicePixelRatio||1)),
        ty: baseY + (Math.sin((p/28)*Math.PI*2) * (18 + (i%2)*6) * (window.devicePixelRatio||1)),
        x: centerX + (Math.random()-0.5)*320,
        y: H + Math.random()*160 + 60,
        hue: 300 + Math.random()*120,
        size: 1 + Math.random()*3
      });
    }
  }
  let t=0;
  function animateToLetters(){
    t++;
    ctx.clearRect(0,0,W,H);
    for(let pt of points){
      // move each point a bit toward target
      pt.x = pt.x + (pt.tx - pt.x) * 0.09;
      pt.y = pt.y + (pt.ty - pt.y) * 0.09;
      ctx.beginPath();
      ctx.fillStyle = `hsla(${pt.hue},70%,70%,0.98)`;
      ctx.arc(pt.x, pt.y, pt.size * (1 + Math.sin(t*0.05)*0.12), 0, Math.PI*2);
      ctx.fill();
    }
    if(t < 120) requestAnimationFrame(animateToLetters);
    else {
      // hold letters, then slowly fade out and leave final banner
      setTimeout(()=> {
        // small shimmer across letters
        ctx.globalCompositeOperation = 'lighter';
        let shimmer=0;
        function shimmerLoop(){
          shimmer++;
          for(let pt of points){
            ctx.beginPath();
            ctx.fillStyle = `hsla(${pt.hue},80%,88%,${0.02 + Math.abs(Math.sin(shimmer*0.06))*0.12})`;
            ctx.arc(pt.x + Math.sin(shimmer*0.02)*5, pt.y, pt.size*1.6, 0, Math.PI*2);
            ctx.fill();
          }
          if(shimmer < 120) requestAnimationFrame(shimmerLoop);
        }
        shimmerLoop();
      }, 500);
    }
  }
  animateToLetters();
}

/* --------- Hook poemFinished into typewriter: call finale ---------- */
function poemDone(){
  // small delay, then finale
  setTimeout(()=> { finale(); }, 700);
}

/* Ensure typeNextLine calls poemDone when finished — we integrate here by wrapping startPoem logic above */
/* We already call poemDone at the end of typeNextLine via typing flag check; but for clarity, after typing completes call poemDone */
(function ensurePoemHook(){
  // We'll override typeNextLine by wrapping startPoem function (already defined). Simpler: after typing finishes we call poemDone explicitly from typeNextLine.
  // We'll implement startPoem/typeNextLine now inline (to be sure)
})();

/* Re-implement typewriter to ensure poemDone is called */
function startPoemFresh(){
  poemEl.textContent=''; pIdx=0; cIdx=0; typing=true;
  (function next(){
    if(pIdx >= poem.length){ typing=false; poemDone(); return; }
    const line = poem[pIdx] + (pIdx < poem.length-1 ? '\n\n' : '');
    cIdx=0;
    const iv = setInterval(()=> {
      poemEl.textContent += line.charAt(cIdx);
      cIdx++; poemEl.scrollTop = poemEl.scrollHeight;
      if(cIdx >= line.length){
        clearInterval(iv);
        pIdx++;
        setTimeout(next, 380 + Math.random()*160);
      }
    }, 18 + Math.floor(Math.random()*22));
  })();
}

/* connect reveal actions to startPoemFresh */
frame.addEventListener('click', async ()=> {
  if(!audioCtx) initAudio();
  if(!isPlaying){
    try{ await audio.play(); isPlaying=true; playBtn.textContent='Pause'; }catch(e){ console.warn(e); }
  }
  reveal();
  if(!typing) startPoemFresh();
});
frame.addEventListener('keydown', async (e)=> { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); frame.click(); } });

/* replay button triggers poem & maybe audio */
replay.addEventListener('click', async ()=> { if(!audioCtx) initAudio(); if(!isPlaying) { try{ await audio.play(); isPlaying=true; playBtn.textContent='Pause'; }catch(e){} } if(!typing) startPoemFresh(); });

/* Helper: ensure audioCtx exists on user gesture */
function initAudio(){ if(audioCtx) return; try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); analyser = audioCtx.createAnalyser(); analyser.fftSize = 128; dataArr = new Uint8Array(analyser.frequencyBinCount); source = audioCtx.createMediaElementSource(audio); source.connect(analyser); analyser.connect(audioCtx.destination); }catch(e){ console.warn('webaudio:', e); } }

/* Update glow cheaply */
function updateAudioGlow(){
  if(!analyser || !isPlaying){ requestAnimationFrame(updateAudioGlow); return; }
  analyser.getByteFrequencyData(dataArr);
  let s=0,cnt=0;
  for(let i=1;i<8 && i<dataArr.length;i++){ s+=dataArr[i]; cnt++; }
  const avg = cnt ? (s/cnt)/255 : 0;
  // apply mild scale & shadow
  const intensity = Math.min(1.2, avg*1.8 + 0.03);
  frame.style.boxShadow = `0 ${12 + intensity*36}px ${20 + intensity*90}px rgba(255,85,140,${0.05 + intensity*0.06})`;
  pic.style.transform = `scale(${1 + intensity*0.012})`;
  requestAnimationFrame(updateAudioGlow);
}
requestAnimationFrame(updateAudioGlow);

/* Start point: gentle invite pulse */
frame.animate([{ transform:'translateY(0)' },{ transform:'translateY(-6px)' },{ transform:'translateY(0)' }], { duration:2600, iterations:Infinity, easing:'ease-in-out' });

/* Safety: stop audio on unload */
window.addEventListener('beforeunload', ()=>{ try{ audio.pause(); audio.src=''; }catch(e){} });

/* Small hint nudge if nothing happens */
setTimeout(()=>{ if(!isPlaying && !revealed){ playBtn.animate([{ transform:'scale(1)' },{ transform:'scale(1.06)' },{ transform:'scale(1)'}], { duration:1100, iterations:1, easing:'ease-in-out' }); } }, 2400);

/* End of script */
</script>
</body>
</html>
```0 
