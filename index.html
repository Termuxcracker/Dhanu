here<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Dhanu</title>
<meta name="description" content="For Dhanu â€” click the photo to play the song and reveal the poem." />
<style>
  :root{
    --bg1:#10052b; --bg2:#2a0545;
    --accent:#ff6fa3; --gold:#ffd08a;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden}
  .wrap{width:min(95vw,980px);max-width:980px;display:flex;flex-direction:column;align-items:center;gap:20px;}

/* center square frame */
  .frame {
    width:min(420px,78vw);
    height: min(420px,78vw);
    border-radius:18px;
    padding:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
    border: 3px solid rgba(255,255,255,0.06);
    box-shadow: 0 30px 70px rgba(6,4,20,0.6);
    display:grid;
    place-items:center;
    position:relative;
    cursor:pointer;
    transform-style:preserve-3d;
    transition: transform 260ms ease, box-shadow 260ms ease;
  }

  /* gold rim look */
  .frame::after{
    content:'';
    position:absolute; inset:8px; border-radius:12px;
    pointer-events:none;
    box-shadow: inset 0 -8px 24px rgba(0,0,0,0.28), 0 10px 30px rgba(0,0,0,0.35);
    border-radius:12px;
  }

  .photo {
    width:100%; height:100%; border-radius:10px; overflow:hidden; position:relative; z-index:1;
    background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.12));
  }
  .photo img{
    width:100%; height:100%; object-fit:cover; display:block; transform-origin:center; transition: transform 900ms cubic-bezier(.2,.9,.2,1);
  }

  /* little play-overlay shown if autoplay blocked */
  .overlay {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:4;
    pointer-events:none;
  }
  .overlay .hint {
    pointer-events:auto;
    background: rgba(0,0,0,0.48);
    padding:10px 14px; border-radius:999px; font-weight:700; color:#fff;
    backdrop-filter: blur(4px);
    display:none;
  }
  .overlay.show .hint{ display:block; }

  /* poem area */
  .poem {
    max-width:820px; text-align:center; line-height:1.8; font-style:italic;
    color:#fff4f7; font-family: "Playfair Display", serif; font-size:18px; min-height:120px;
    padding:0 12px;
    white-space:pre-wrap;
  }

  /* final rain holder */
  .rain { position:fixed; inset:0; pointer-events:none; z-index:9; }

  /* On-focus ring for accessibility */
  .frame:focus { outline:3px solid rgba(255,111,163,0.14); outline-offset:8px; border-radius:14px; }

  @media (max-width:640px){
    .poem{font-size:16px; padding:0 8px}
  }
</style>
</head>
<body>
  <!-- audio element, will be controlled by clicking the frame -->
  <audio id="audio" src="song.mp3" crossorigin="anonymous" preload="auto"></audio>

  <div class="wrap" role="main" aria-labelledby="title">
    <h2 id="title" style="margin:0 0 6px 0;font-family:Inter,system-ui;font-weight:700;color:#ffd6ec">For Dhanu</h2>

    <!-- square frame: clicking this plays music and reveals poem -->
    <div class="frame" id="frame" role="button" tabindex="0" aria-label="Open locket and play song">
      <div class="photo" id="photo">
        <img id="us" src="us.png" alt="A photo of us together (Dhanu and me)" onerror="this.onerror=null; this.src='https://placehold.co/600x600/2a0545/f3e8ff?text=Our+Photo';" />
      </div>

      <div class="overlay" id="overlay">
        <div class="hint" id="overlayHint">Tap to play</div>
      </div>
    </div>

    <!-- preserved original poem lines (unchanged) -->
    <div class="poem" id="poem" aria-live="polite" tabindex="0">
      <span id="L1">My dearest Dhanu,</span>
      <span id="L2">\nIn the universe of my life,</span>
      <span id="L3">\nYou are the star that outshines them all.</span>
      <span id="L4">\nMy love for you grows with every breath,</span>
      <span id="L5">\nAn endless galaxy of shared moments.</span>
    </div>
  </div>

  <div class="rain" id="rain"></div>

<script>
/* Single-file behavior:
   - clicking or pressing Enter on the square frame starts audio AND the typewriter poem
   - if audio.play() is blocked, show a small overlay "Tap to play" (user gesture required)
   - final rain effect at the end (limited DOM, lightweight)
   - photo remains square and uses object-fit: cover
*/

/* Elements */
const frame = document.getElementById('frame');
const audio = document.getElementById('audio');
const poemContainer = document.getElementById('poem');
const rainHolder = document.getElementById('rain');
const overlay = document.getElementById('overlay');
const overlayHint = document.getElementById('overlayHint');
const img = document.getElementById('us');

/* poem original lines (kept exactly) */
const lines = [
  "My dearest Dhanu,",
  "In the universe of my life,",
  "You are the star that outshines them all.",
  "My love for you grows with every breath,",
  "An endless galaxy of shared moments."
];

let lineIndex = 0, charIndex = 0, typing = false, iv = null;

/* typewriter that reveals exactly those lines in the displayed poem container */
function startTyping(restart=false){
  if(restart){ // clear visible text
    poemContainer.textContent = '';
    lineIndex = 0; charIndex = 0;
  }
  if(typing) return;
  typing = true;

  (function nextLine(){
    if(lineIndex >= lines.length){
      typing = false;
      setTimeout(finalRain, 800);
      return;
    }
    const line = lines[lineIndex] + (lineIndex < lines.length - 1 ? '\n' : '');
    charIndex = 0;
    iv = setInterval(()=>{
      poemContainer.textContent += line.charAt(charIndex) || '';
      charIndex++;
      poemContainer.scrollTop = poemContainer.scrollHeight;
      if(charIndex >= line.length){
        clearInterval(iv);
        lineIndex++;
        setTimeout(nextLine, 420);
      }
    }, 36); // speed comfortable & smooth
  })();
}

/* click / key interaction: try to play audio and start poem */
async function handleOpen(){
  // subtle visual pop
  frame.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 700, easing: 'ease-in-out' });

  // attempt to play audio
  try {
    await audio.play();
    overlay.classList.remove('show');
  } catch(err){
    // autoplay blocked â€” show overlay hint so the user can tap to play
    overlay.classList.add('show');
    overlayHint.textContent = 'Tap the photo again to play';
    return;
  }

  // scale image a bit to show interaction
  img.style.transform = 'scale(1.02)';
  setTimeout(()=> img.style.transform = '', 900);

  // begin typing poem if not already
  if(!typing) startTyping(true);
}

/* double-tap behavior: when overlay hint showing, second tap triggers audio (user gesture) */
frame.addEventListener('click', async (e)=>{
  if(overlay.classList.contains('show')){
    // try to play explicitly (user gesture)
    try {
      await audio.play();
      overlay.classList.remove('show');
      // start poem after play
      if(!typing) startTyping(true);
    } catch(err){
      // still blocked; keep hint
      overlayHint.textContent = 'Tap again to allow sound';
    }
  } else {
    handleOpen();
  }
});

/* keyboard accessibility */
frame.addEventListener('keydown', async (e)=>{
  if(e.key === 'Enter' || e.key === ' '){
    e.preventDefault();
    // same behavior
    if(overlay.classList.contains('show')){
      try { await audio.play(); overlay.classList.remove('show'); if(!typing) startTyping(true); } catch(_) {}
    } else {
      handleOpen();
    }
  }
});

/* small fallback: if audio becomes playable later, hide overlay */
audio.addEventListener('play', ()=>{ overlay.classList.remove('show'); });

/* final rain effect (lightweight DOM usage) */
function finalRain(){
  const message = "I love you Dhanu ðŸ’–";
  const max = 20;
  for(let i=0;i<max;i++){
    const el = document.createElement('div');
    el.textContent = message;
    el.style.position = 'fixed';
    el.style.left = (6 + Math.random()*88) + 'vw';
    el.style.top = (-8 - Math.random()*20) + 'vh';
    el.style.zIndex = 9999;
    el.style.pointerEvents = 'none';
    el.style.fontFamily = '"Playfair Display", serif';
    el.style.color = '#ffb6c1';
    el.style.textShadow = '0 6px 18px rgba(255,100,150,0.6)';
    el.style.fontSize = (12 + Math.random()*18) + 'px';
    rainHolder.appendChild(el);
    const duration = 3200 + Math.random()*1800;
    el.animate([
      { transform: 'translateY(0) scale(0.9)', opacity: 0 },
      { transform: `translateY(${120 + Math.random()*80}vh) scale(1.02)`, opacity: 1 }
    ], { duration, easing: 'cubic-bezier(.2,.9,.2,1)', fill: 'forwards' });
    setTimeout(()=> el.remove(), duration + 300);
  }
}

/* small invite pulse on load */
setTimeout(()=> {
  frame.animate([{ transform:'translateY(0)' }, { transform:'translateY(-6px)' }, { transform:'translateY(0)' }], { duration: 2400, iterations: 1, easing: 'ease-in-out' });
}, 350);

/* Make sure the image stays perfectly square even when resized:
   CSS already enforces equal width/height. Nothing else needed.
*/

/* Pause audio when page hidden to be polite & save CPU */
document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ try { audio.pause(); } catch(e){} } });

/* console hint */
console.log("If the song doesn't start automatically, tap the photo again (browser might require a gesture).");

</script>
</body>
</html>
